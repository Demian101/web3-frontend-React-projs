é¡¹ç›® Web åœ°å€ï¼š[https://buildspace.so/](https://buildspace.so/)

æœ¬é¡¹ç›® Tutorialï¼š[https://github.com/buildspace/buildspace-projects](https://github.com/buildspace/buildspace-projects)

æœ¬é¡¹ç›®ä»£ç ï¼šhttps://gist.github.com/adilanchian/93fbd2e06b3b5d3acb99b5723cebd925



```js
npx hardhat run ./scripts/run.js
npx hardhat run scripts/deploy.js --network rinkeby
> WavePortal address: 0xF0e8C3c63Af52F884BD6C0439aE64842697761D9
> check Contractï¼š https://rinkeby.etherscan.io/address/0xC0A722E33e0A2f91d6492E385964253Fe9661369

0. ä¿®æ”¹åˆçº¦åï¼Œé‡æ–° deploy
1. ä¿®æ”¹ App.js é‡Œé¢çš„åˆçº¦åœ°å€
2. å¤åˆ¶ ADD çš„ json åˆ° Front çš„ src/utils/
```



## Review : ä»£ç é˜…è¯»ï¼š

### 0. æ•ˆæœå±•ç¤º

æ²¡æœ‰ç™»å½•çš„è¯ï¼Œé¦–å…ˆè¦é€šè¿‡ MetaMask é’±åŒ…ç™»å½•

<img src="/Users/soda/Library/Application Support/typora-user-images/image-20220508191021941.png" alt="image-20220508191021941" style="zoom:30%;" />

ç™»å½•åï¼š

![](http://imagesoda.oss-cn-beijing.aliyuncs.com/Sodaoo/2022-05-08-111648.png)



### 1. WavePortal.sol

https://github.com/numoonchld

```solidity
pragma solidity ^0.8.4;

import "hardhat/console.sol";

contract WavePortal {
    // uint256 totalWaves;
    mapping(address => uint256) private trackWaveCount;  // è®°å½•æŸä¸ª sender æŒ¥äº† x æ¬¡æ‰‹ã€‚
    mapping(address => uint256) public lastWavedAt;
    uint256 private seed;

    event NewWave(address indexed from, uint256 timestamp, string message);

    struct Wave {  // ç”¨æˆ·å‘é€ Message ç»™æˆ‘ä»¬çš„ struct ç»“æ„ã€‚
        address waver;
        string message;
        uint256 timestamp;
    }

    Wave[] waves;  // an array of structs.

    constructor() payable {    // `payable`å…³é”®å­—ä»£è¡¨æ­¤å‡½æ•° (contract? ) å¯ä»¥æ¥å—è½¬è´¦ 
        console.log("We have been constructed!");
        seed = (block.timestamp * block.difficulty) % 100;  // è°ƒä¸€äº›å…¨å±€å˜é‡ç”Ÿæˆéšæœº seed
    }

    function wave(string memory _message) public {
        require(   // éœ€è¦ä¸¤æ¬¡ wave() çš„æ—¶é—´é—´éš” > 1s
            lastWavedAt[msg.sender] + 1 seconds < block.timestamp,
            "1s cool-down for this waver active!"
        );

        lastWavedAt[msg.sender] = block.timestamp;  // è®°å½•å½“å‰æ—¶é—´ä½œä¸ºæœ€åä¸€æ¬¡

        // totalWaves += 1;
        // console.log("%s has waved!", msg.sender);
        console.log("%s waved with message %s", msg.sender, _message);

        // æŒ¥æ‰‹ã€æ‰“æ‹›å‘¼çš„ä¿¡æ¯è®°å…¥æ•°ç»„
        waves.push(Wave(msg.sender, _message, block.timestamp));  

        trackWaveCount[msg.sender] += 1;  // è®°å½•æŸä¸ª sender æŒ¥äº† x æ¬¡æ‰‹ã€‚

        // éšæœºç§å­ï¼Œå–æ¨¡ï¼Œä¿è¯æ•°å­—åœ¨ 0-99
        seed = (block.difficulty + block.timestamp + seed) % 100; 
        console.log("Random # generated: %d", seed);

        if (seed < 50) {   // æœ‰ 50% çš„æ¦‚ç‡ç”¨æˆ·å¯ä»¥é€šè¿‡æŒ¥æ‰‹è·å¾— Contract ä¸Šçš„ eth ï¼
            uint256 prizeAmount = 0.0001 ether;
            require(
                // address(this).balance æŒ‡åˆçº¦æœ¬èº«çš„ä½™é¢ï¼Œæ¯”è¾ƒ 2 è€…ã€‚
                prizeAmount <= address(this).balance,
                "Trying to withdraw more moneythan the contract has."
            );
            // æ±‡æ¬¾çš„ç¥å¥‡çº¿è·¯
            (bool success, ) = (msg.sender).call{value: prizeAmount}("");
            require(success, "Failed to withdraw money from contract");
        }

        emit NewWave(msg.sender, block.timestamp, _message);
    }

    // è·å–æ€»çš„è¢«äººæŒ¥æ‰‹çš„æ¬¡æ•°
    function getTotalWaves() public view returns (uint256) {  
        return waves.length;
    }

    // æŸ¥çœ‹æŸä¸ªäº¤äº’è€… å’Œæˆ‘ä»¬äº¤äº’(æŒ¥æ‰‹)çš„æ¬¡æ•°
    function getWaveCount(address interactor) public view returns (uint256) {
        console.log(
            "%s has waved %d time(s)!",
            interactor,
            trackWaveCount[interactor]
        );
        return trackWaveCount[interactor];
    }

    function getAllWaves() public view returns (Wave[] memory) {
        return waves;
    }
    // receive() external payable {}
}
```





### 2. run.js

ç°åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å·²ç»å†™å¥½äº†ï¼Œåœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼Œè¦åœ¨æœ¬åœ°åšä¸€äº›æµ‹è¯•ã€‚

é€šè¿‡ `hre.ethers.utils.parseEther("0.1"),` å‘ payable çš„ Contract æ·»åŠ ä½™é¢ (balance)

```js
const main = async () => {

  const [owner, randomPerson] = await hre.ethers.getSigners()

  const waveContractFactory = await hre.ethers.getContractFactory("WavePortal")
  const waveContract = await waveContractFactory.deploy({
    value: hre.ethers.utils.parseEther("0.1"),
  })  // è¯•å›¾éƒ¨ç½²
  await waveContract.deployed()  // ç­‰å¾…éƒ¨ç½²å®Œæˆ

  console.log("Contract deployed to: ", waveContract.address)
  console.log("Contract deployed by: ", owner.address)

  let contractBalance = await hre.ethers.provider.getBalance(waveContract.address)
  console.log("Contract Balance:", hre.ethers.utils.formatEther(contractBalance))


  await waveContract.getWaveCount(owner.address)
  await waveContract.getWaveCount(randomPerson.address)

  let waveCount
  waveCount = await waveContract.getTotalWaves()

  let waveTxn = await waveContract.wave('message 1')  // æµ‹è¯•æŒ¥æ‰‹ Message
  await waveTxn.wait()
  waveCount = await waveContract.getTotalWaves()
  
  // ç”Ÿæˆéšæœºç”¨æˆ·çš„æ–¹æ³• randomPerson
  waveTxn = await waveContract.connect(randomPerson).wave('message 2')
  await waveTxn.wait()
  waveCount = await waveContract.getTotalWaves()

  waveTxn = await waveContract.wave('message 3')
  await waveTxn.wait()
  await waveContract.getTotalWaves()
  await waveContract.getWaveCount(owner.address)
  await waveContract.getWaveCount(randomPerson.address)

  contractBalance = await hre.ethers.provider.getBalance(waveContract.address)
  console.log("Contract Balance:", hre.ethers.utils.formatEther(contractBalance))

  let allWaves = await waveContract.getAllWaves()
  console.log(allWaves)
}

const runMain = async () => {
  try {
    await main()
    process.exit(0)
  } catch (error) {
    console.error(error)
    process.exit(1)
  }
}

runMain()
```

```js
outputï¼š
Compiled 1 Solidity file successfully
We have been constructed!
Contract deployed to:  0x5FbDB2315678afecb367f032d93F642f64180aa3
Contract deployed by:  0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
Contract Balance: 0.1
0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 has waved 0 time(s)!
0x70997970c51812dc3a010c7d01b50e0d17dc79c8 has waved 0 time(s)!
0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 waved with message message 1
Random # generated: 30
0x70997970c51812dc3a010c7d01b50e0d17dc79c8 waved with message message 2
Random # generated: 73
0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 waved with message message 3
Random # generated: 81
0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 has waved 2 time(s)!
0x70997970c51812dc3a010c7d01b50e0d17dc79c8 has waved 1 time(s)!
Contract Balance: 0.0999
[
  [
    '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    'message 1',
    BigNumber { value: "1651896942" },
    waver: '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    message: 'message 1',
    timestamp: BigNumber { value: "1651896942" }
  ],
  [
    '0x70997970C51812dc3A010C7d01b50e0d17dc79C8',
    'message 2',
    BigNumber { value: "1651896943" },
    waver: '0x70997970C51812dc3A010C7d01b50e0d17dc79C8',
    message: 'message 2',
    timestamp: BigNumber { value: "1651896943" }
  ],
  [
    '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    'message 3',
    BigNumber { value: "1651896944" },
    waver: '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    message: 'message 3',
    timestamp: BigNumber { value: "1651896944" }
  ]
]

```



### 3. deploy.js

éƒ¨ç½²ä»£ç ï¼ŒæŠŠæˆ‘ä»¬é’±åŒ…é‡Œçš„å¸çœŸå®å‘é€åˆ°åˆçº¦ã€‚

```js
const main = async () => {
  const [deployer] = await hre.ethers.getSigners()
  const accountBalance = await deployer.getBalance()

  console.log("Account deploying contracts: ", deployer.address)
  console.log("Account balance: ", accountBalance.toString())

  const waveContractFactory = await hre.ethers.getContractFactory("WavePortal")
  const waveContract = await waveContractFactory.deploy({
    value: hre.ethers.utils.parseEther("0.001"),   // å‘é€ 0.001 ä¸ªå¸åˆ°é“¾ä¸Šåˆçº¦ã€‚
  })
  await waveContract.deployed()

  console.log("WavePortal address: ", waveContract.address)
}

const runMain = async () => {
  try {
    await main()
    process.exit(0)
  }
  catch (error) {
    console.error(error)
    process.exit(1)
  }
}

runMain()
```



```solidity
$ npx hardhat run scripts/deploy.js --network rinkeby
Account deploying contracts:  0x65d5b68A7878A987e7A19826A7f9Aa6F5F92e10F
Account balance:  85701084573562765
WavePortal address:  0xF0e8C3c63Af52F884BD6C0439aE64842697761D9
```





### 4. App.js

å¤§å¤´æ¥äº†ï¼Œå‰ç«¯ä»£ç ã€‚

```react
import React, { useEffect, useState } from 'react';
import { ethers } from 'ethers';
import './App.css';
import abi from './utils/WavePortal.json';

export default function App() {
  const [inputMessage, setInputMessage] = useState('');

  // useState èµ‹ null çš„åˆå§‹å€¼ç»™ currentAccountï¼Œä½¿ç”¨ setCurrentAccount å¯¹ currentAccount çš„ value è¿›è¡Œæ›´æ”¹
  // å½“æˆ‘ä»¬è¿æ¥åˆ° MetaMask å‰ï¼ŒuseStateä¸ºç©º  ;  å½“æˆ‘ä»¬è¿æ¥åˆ° MetaMask åï¼ŒuseStateä¸ºé¦–ä¸ªè´¦å·åœ°å€
  const [currentAccount, setCurrentAccount] = useState(null);
  const [totalWaves, setTotalWaves] = useState(null);
  const [allWaves, setAllWaves] = useState([]);
  const [isMining, setIsMining] = useState(false);
  const [isLoggedIn, setIsLoggedIn] = useState(false);

  const contractAddress = '0xF0e8C3c63Af52F884BD6C0439aE64842697761D9';
  const contractABI = abi.abi;

  const onNewWave = (from, timestamp, message) => {
    console.log('NewWave', from, timestamp, message);

    // å°† allWaveså±•å¼€ä¹‹å‰çš„æ•°æ®ï¼ˆWaves,å³åˆ«äººå’Œæˆ‘ä»¬æ‰“æ‹›å‘¼çš„ Messagesï¼‰
    // å†æŠŠæœ€æ–°çš„ struct å¯¹è±¡ è¿½åŠ ä¸Šå»ã€‚
    setAllWaves( [
      ...allWaves,
      {
        address: from.toString(),
        timestamp: new Date(timestamp * 1000).toString(),
        message: message
      }
    ]);
  };

  // æ¯”è¾ƒ 2 æ¬¡æ‰“æ‹›å‘¼ä¹‹å‰çš„æ—¶é—´é—´éš”ï¼Œé—´éš”ä¸èƒ½å¤§çŸ­ã€‚
  const compareTimestamps = (waveA, waveB) => {
    if (waveA.timestamp > waveB.timestamp) {  return -1; }
    if (waveA.timestamp < waveB.timestamp) {  return 1;  }
    return 0;
  };

  const connectWallet = async () => {
    const { ethereum } = window;  // è§£åŒ…å¯¹è±¡, window æœ‰ä¸Šåƒä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åªè¦ MetaMask æ³¨å…¥çš„è¿™ä¸ªethereum å°±å¯ä»¥äº†ã€‚
    const accounts = await ethereum.request({
      // ethereum çš„ eth_requestAccounts æ–¹æ³•æ˜¯å»ºç«‹åˆå§‹è¿æ¥ MetaMask çš„å‡½æ•°ã€‚
      method: 'eth_requestAccounts'   
    });

    const account = accounts[0];
    console.log('Connected', account);
    setCurrentAccount(account);
    setIsLoggedIn(true);
    getAllWaves();
  };

  // è¾“å…¥æ¡†ä¸­éœ€è¦å†™ä¸œè¥¿æ‰èƒ½æäº¤ï¼Œå¦åˆ™å°±ä¼šåœ¨æµè§ˆå™¨å¼¹å‡º Alertã€‚
  const wave = async () => {
    if (inputMessage.trim() === '') {
      alert( "Leave a comment in the text box above the 'Wave at Me' button and then hit the button!"  );
      return;
    }

    try {
      const { ethereum } = window;  // è§£åŒ…å¯¹è±¡,

      if (!ethereum) { 
        alert('Install Metamask!'); 
        return;   }

      const provider = new ethers.providers.Web3Provider(ethereum);
      const signer = provider.getSigner();
      const wavePortalContract = new ethers.Contract(  // è¿æ¥é’±åŒ…çš„ä¸€äº›é…ç½®ï¼Œè¿˜è®°å¾— ABI å— ï¼Ÿ
        contractAddress,
        contractABI,
        signer
      );

      const waveTxn = await wavePortalContract.wave(inputMessage, {  // è®¾ç½®æ¶ˆè€—çš„æœ€å¤§ gas
        gasLimit: 1000000
      });
      console.log('Mining: ', waveTxn.hash);   // å½“æœ‰äººæäº¤äº† Message åï¼Œåˆçº¦å°±ä¼šå°è¯•ä¿®æ”¹å˜é‡ï¼Œå°†å…¶å†™åˆ°åŒºå—é“¾ä¸Šï¼Œè¿™éœ€è¦æ—¶é—´ã€‚
      setIsMining(true);

      await waveTxn.wait();
      console.log('Mined!', waveTxn.hash);  // åœ¨åŒºå—é“¾ä¸Šæ”¹åŠ¨å®Œæ¯•åï¼Œè¿”å› Transaction çš„ hash å€¼ã€‚
      setIsMining(false);

      const waves = await wavePortalContract.getAllWaves();
      setTotalWaves(waves.length);   // è®¾ç½®ç›®å‰å’Œæˆ‘ä»¬æ‰“æ‹›å‘¼çš„æ‹›å‘¼æ€»æ•°ã€‚

      const processedWaves = waves.map(wave => {
        return {
          address: wave.waver.toString(),
          timestamp: new Date(wave.timestamp * 1000).toString(),
          message: wave.message
        };
      });
      setAllWaves(processedWaves);
    } catch (error) {
        console.log(error);
        alert("If you've already waved today, come back tomorrow!");
        setIsMining(false);
    }
  };

  // æ£€æŸ¥é’±åŒ…æ˜¯å¦é“¾æ¥
  const checkWalletConnection = async () => {
    try {
      const { ethereum } = window;

      if (!ethereum) {
        console.log('Install MetaMask!');
        alert('MetaMask needed to use this site!');
      } else {
        console.log('Ethereum object found!', ethereum);
      }
      // ethereum çš„ eth_accounts æ–¹æ³•æŸ¥çœ‹æ˜¯å¦æœ‰æƒè®¿é—®ç”¨æˆ·é’±åŒ…ä¸­çš„å¸æˆ·ã€‚
      const accounts = await ethereum.request({ method: 'eth_accounts' });

      if (accounts.length !== 0) {
        const account = accounts[0];  // æœ‰å¯èƒ½æ‹¿åˆ°è¿æ¥åˆ° MetaMask çš„å¤šä¸ªè´¦æˆ·ï¼Œè¿™é‡Œåªå–ç¬¬ä¸€ä¸ªã€‚
        console.log('Found authorized account!', account);
        setCurrentAccount(account);
        setIsLoggedIn(true);
      } else {
        console.log('No authorized account found!');
        setIsLoggedIn(false);
      }
    } catch (error) {
      console.error(error);
    }
  };

  // eslint-disable-next-line react-hooks/exhaustive-deps
  const getAllWaves = async () => {
    try {
      const { ethereum } = window;

      if (!ethereum) {  alert('Install Metamask!');  return;  }

      const provider = new ethers.providers.Web3Provider(ethereum);
      const signer = provider.getSigner();
      const wavePortalContract = new ethers.Contract(   // è¿æ¥é’±åŒ…çš„ä¸€äº›é…ç½®ï¼Œè¿˜è®°å¾— ABI å— ï¼Ÿ
        contractAddress,
        contractABI,
        signer
      );

      const waves = await wavePortalContract.getAllWaves();
      const processedWaves = waves.map(wave => {
        return {
          address: wave.waver,
          timestamp: new Date(wave.timestamp * 1000),
          message: wave.message
        };
      });
      setAllWaves(processedWaves);
    } catch (error) {
      console.error(error);
    }
  };

  // å‰¯ä½œç”¨ hookï¼Œ [] æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œå› ä¸º [] æ˜¯ç©ºæ•°ç»„ï¼Œä¸ä¼šå˜ï¼Œæ‰€ä»¥å‡½æ•°ä½“æ“ä½œåªæ‰§è¡Œä¸€æ¬¡ã€‚
  useEffect(() => {
    let wavePortalContract;

    if (window.ethereum) {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();

      wavePortalContract = new ethers.Contract(
        contractAddress,
        contractABI,
        signer
      );
      // ethers.contract.on æ˜¯ ethers.js ä¸­ç”¨æ¥ç›‘å¬äº‹ä»¶Event çš„ã€‚
      // https://learnblockchain.cn/docs/ethers.js/api-contract.html#id6
      //  åœ¨åˆçº¦é‡Œé¢äº‹ä»¶æ˜¯è¿™ä¹ˆå†™çš„ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œæ‰€ä»¥è¯´ 'NewWave' å°±æ˜¯æŒ‡åˆçº¦é‡Œçš„äº‹ä»¶
      //    event NewWave(address indexed from, uint256 timestamp, string message);
      // ä»æ‰§è¡Œè¿‡ç¨‹ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒonNewWave è¿™ä¸ªå‡½æ•°æ˜¯åœ¨ Mining åï¼Œ Mined å®Œæˆçš„åŒæ—¶(æˆ–ä¹‹å)å¯åŠ¨ã€log çš„ã€‚

      wavePortalContract.on('NewWave', onNewWave);
    }

    return () => {
      if (wavePortalContract) {
        // Unsubscribe listener to event.  å–æ¶ˆè®¢é˜…äº‹ä»¶ Events 
        wavePortalContract.off('NewWave', onNewWave);
      }
    };
  }, []);

  // React hook, å‰¯ä½œç”¨ hookï¼Œ [] æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚æœ [] å†…çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™æ‰§è¡Œ 2 ä¸ªå‡½æ•°
  // å› ä¸º [] æ˜¯ç©ºæ•°ç»„ï¼Œä¸ä¼šå˜ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚
  useEffect(() => {
    checkWalletConnection();
    getAllWaves();
  }, []);

  return (
    <div className="mainContainer">
	  {!isLoggedIn && (
        <button className="loginButton" onClick={connectWallet}>
          Login to MetaMask
        </button>
      )}
      {isLoggedIn && (
        <div className="dataContainer">
		  {/* ç»™å›¾ç‰‡åŠ è·³è½¬é“¾æ¥ */}
          <a
            href="https://github.com/Sodaoo"
            // eslint-disable-next-line react/jsx-no-target-blank
            target="_blank"  >
            <img className="logo" src="https://avatars.githubusercontent.com/u/33189338?v=4"  alt="numoonchld" />
          </a>

          <div className="bio">
            <a href="https://github.com/Sodaoo"
            > Demian </a>
            
			{/* ç½‘æ˜“äº‘éŸ³ä¹çš„ iframe */}
            <iframe   
			  style={{ borderRadius: '12px', margin: '10px 0px 0px 0px' }} 
			  src="//music.163.com/outchain/player?type=0&id=7133315069&auto=1&height=430"
			  frameBorder="0" title="iframe2" width="100%" height="240" 
              />
            <br />

            {!isMining && (
              <div className="waveTile">
                <textarea
                  className="waveMessage"
                  placeholder="è·Ÿæˆ‘æ‰“ä¸ªæ‹›å‘¼å§ ! ~ "
                  value={inputMessage}
                  onChange={event => setInputMessage(event.target.value)}
                  rows="5"
                  required
                />
                <button className="waveButton" onClick={wave}>
                  <div> Wave at Me </div>
                  <small className="totalWaves">{allWaves.length}</small>
                </button>
                <small>(ETH wallet signature required)</small>
              </div>
            )}
            {isMining && (
              <>
                <div className="miningSpinner" />
              </>
            )}
          </div>

          <div className="waveTable">
            <b style={{ marginBottom: '0%' }}>Wave Log</b>
            {allWaves.sort(compareTimestamps).map(wave => (
              <div key={Date.parse(wave.timestamp)} className="waveTableEntry">
                <small>{wave.address}</small>
                <small>{wave.timestamp.toString()}</small>
                <hr style={{ width: '100%' }} />
                {wave.message ? wave.message : '<blank message>'}
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}
```











## é¡¹ç›®ç›®æ ‡

React web3 åº”ç”¨ç¨‹åº + ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ã€‚ 

Big Pictureï¼š

1.Â **We're going to write a smart contract.**Â That contract like your server code.

2.Â **Our smart contract will be deployed to the blockchain.**Â This way, anyone in the world will be able to access and run our smart contract (if we give them permission to do so)

3.Â **We're going to build a client website**Â that will let people easily interact with our smart contract on the blockchain.



Hardhat ä»‹ç»ï¼š

>  Hardhatæ˜¯ä¸€ä¸ªç¼–è¯‘ã€éƒ¨ç½²ã€æµ‹è¯•å’Œè°ƒè¯•ä»¥å¤ªåŠåº”ç”¨çš„å¼€å‘ç¯å¢ƒã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ç®¡ç†å’Œè‡ªåŠ¨åŒ–æ„å»ºæ™ºèƒ½åˆçº¦å’ŒdAppsè¿‡ç¨‹ä¸­å›ºæœ‰çš„é‡å¤æ€§ä»»åŠ¡ï¼Œå¹¶å›´ç»•è¿™ä¸€å·¥ä½œæµç¨‹è½»æ¾å¼•å…¥æ›´å¤šåŠŸèƒ½ã€‚è¿™æ„å‘³ç€hardhatåœ¨æœ€æ ¸å¿ƒçš„åœ°æ–¹æ˜¯ç¼–è¯‘ã€è¿è¡Œå’Œæµ‹è¯•æ™ºèƒ½åˆçº¦ã€‚
>
> Hardhatå†…ç½®äº†Hardhatç½‘ç»œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºå¼€å‘è®¾è®¡çš„æœ¬åœ°ä»¥å¤ªåŠç½‘ç»œã€‚ä¸»è¦åŠŸèƒ½æœ‰Solidityè°ƒè¯•ï¼Œè·Ÿè¸ªè°ƒç”¨å †æ ˆã€`console.log()`å’Œäº¤æ˜“å¤±è´¥æ—¶çš„æ˜ç¡®é”™è¯¯ä¿¡æ¯æç¤ºç­‰ã€‚



### ç¯å¢ƒéƒ¨ç½²

1. ä¸‹è½½ VS Code é«˜äº®æ‰©å±• ï¼š[here](https://marketplace.visualstudio.com/items?itemName=JuanBlanco.solidity)

2. ä¸‹è½½ Node.js æœ€æ–°ç‰ˆæœ¬

```solidity
mkdir my-wave-portal
cd my-wave-portal
npm init -y
npm install --save-dev hardhat

npx hardhat

npm install --save-dev @nomiclabs/hardhat-waffle ethereum-waffle chai @nomiclabs/hardhat-ethers ethers
```

> æ³¨æ„ï¼šå¦‚æœä½ åœ¨ npm çš„åŒæ—¶å®‰è£…äº† yarnï¼Œä½ å¯èƒ½ä¼šå¾—åˆ° npm ERR ä¹‹ç±»çš„é”™è¯¯ï¼æ— æ³•ç¡®å®šè¦è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ `yarn add hardhat` 
> 



Finally, runÂ `npx hardhat accounts`Â and this should print out a bunch of strings that look like this:

`0xa0Ee7A142d267C1f36714E4a8F75612F20a79720`

è¿™äº›æ˜¯ Hardhat ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ä»¥å¤ªåŠåœ°å€ï¼Œç”¨äºæ¨¡æ‹ŸåŒºå—é“¾ä¸Šçš„çœŸå®ç”¨æˆ·ã€‚å½“æˆ‘ä»¬æƒ³æ¨¡æ‹Ÿç”¨æˆ·å¯¹æˆ‘ä»¬çš„æ”»å‡»æ—¶ï¼Œè¿™å°†åœ¨é¡¹ç›®åæœŸå¸®åŠ©æˆ‘ä»¬å¾ˆå¤šï¼

To make sure everything is working, run:

```
 npx hardhat compile
```

Then run:

```
npx hardhat test
```



Remove  (ä¸è¦åˆ é™¤å®é™…çš„æ–‡ä»¶å¤¹! ): 

- ./test/sample-test.js
- ./scripts/sample-script.js
- ./contracts/Greeter.sol



## A smart contract 

Let's build a smart contract 

```solidity
// æ–‡ä»¶åœ°å€ï¼š    ./my-wave-portal/contracts/WavePortal.sol

// SPDX-License-Identifier: UNLICENSED

// æ³¨æ„ç¡®ä¿ç‰ˆæœ¬å’Œ hardhat.config.js  ä¸­çš„ä¸€æ ·ã€‚
pragma solidity ^0.8.4;

import "hardhat/console.sol";

contract WavePortal {
    constructor() {
        console.log("Yo yo, I am a contract and I am smart");
    }
}
```

åˆ›å»ºå¥½ä¸€ä»½ Contract åï¼Œåªéœ€ï¼š

1. ç¼–è¯‘å®ƒã€‚

2. å°†å…¶éƒ¨ç½²åˆ°æˆ‘ä»¬çš„æœ¬åœ°åŒºå—é“¾ã€‚

åˆ›å»ºä¸€ä¸ªè„šæœ¬å¼€è¿è¡Œåˆçº¦ï¼š

```solidity
//  ./scripts/run.js

const main = async () => {
  // hre.ethers  åç»­ä¼šè®²ã€‚
  const waveContractFactory = await hre.ethers.getContractFactory("WavePortal");

  // ç¼–è¯‘æˆ‘ä»¬çš„åˆçº¦å¹¶åœ¨ artifacts ç›®å½•ä¸‹ç”Ÿæˆæˆ‘ä»¬ä½¿ç”¨åˆçº¦æ‰€éœ€çš„å¿…è¦æ–‡ä»¶ã€‚è¿è¡Œåå»æ£€æŸ¥ä¸€ä¸‹:)ã€‚
  const waveContract = await waveContractFactory.deploy();

  // Hardhat å°†ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæœ¬åœ°ä»¥å¤ªåŠç½‘ç»œï¼Œbut just for this contract
  // after the script completes it'll destroy that local network.
  //æ‰€ä»¥ï¼Œæ¯æ¬¡è¿è¡Œåˆçº¦æ—¶ï¼Œå®ƒéƒ½ä¼šæ˜¯ä¸€ä¸ªå…¨æ–°çš„åŒºå—é“¾,è¿™ä½¿å¾— Debug å˜å¾—å®¹æ˜“
  await waveContract.deployed();

  //waveContract.address ä¼šä¸ºæˆ‘ä»¬æä¾›éƒ¨ç½²åœ¨ Blockchain çš„åˆçº¦çš„åœ°å€. 
  console.log("Contract deployed to:", waveContract.address);
};

const runMain = async () => {
  try {
    await main();
    process.exit(0); // exit Node process without error
  } catch (error) {
    console.log(error);
    process.exit(1); // exit Node process while indicating 'Uncaught Fatal Exception' error
  }
  // Read more about Node exit ('process.exit(num)') status codes here: https://stackoverflow.com/a/47163396/7974948
};

runMain();
```

Run it ï¼ ï¼š

```solidity
$ npx hardhat run ./scripts/run.js

Output:
  Downloading compiler 0.8.4
  Compiled 2 Solidity files successfully
  Yo yo, I am a contract and I am smart
  Contract deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3
```

`hre.ethers:`

ç›´æ¥ä» Hardhat æ–‡æ¡£æœ¬èº«ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼š

Hardhat Runtime Environmentï¼Œæˆ–ç®€ç§° HREï¼Œæ˜¯ä¸€ä¸ªåŒ…å« Hardhat åœ¨è¿è¡Œä»»åŠ¡ã€æµ‹è¯•æˆ–è„šæœ¬æ—¶å…¬å¼€çš„æ‰€æœ‰åŠŸèƒ½çš„å¯¹è±¡ã€‚å®é™…ä¸Šï¼ŒHardhat å°±æ˜¯ HREã€‚

é‚£ä¹ˆè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå¥½å§ï¼Œæ¯æ¬¡æ‚¨è¿è¡Œä»¥ `npx hardhat` å¼€å¤´çš„ç»ˆç«¯å‘½ä»¤æ—¶ï¼Œéƒ½ä¼šä½¿ç”¨ä»£ç ä¸­æŒ‡å®šçš„ hardhat.config.js åŠ¨æ€æ„å»ºè¿™ä¸ª hre å¯¹è±¡ï¼è¿™æ„å‘³ç€æ‚¨å°†æ°¸è¿œä¸å¿…å®é™…å¯¹æ–‡ä»¶è¿›è¡ŒæŸç§å¯¼å…¥ï¼Œä¾‹å¦‚ï¼š

```solidity
const hre = require("hardhat")
```

Hardhat æ–‡æ¡£ï¼š **[Hardhat documentation](https://hardhat.org/advanced/hardhat-runtime-environment.html)**

æ›´è¿›ä¸€æ­¥ï¼š

- è®°å½•åˆçº¦è°ƒç”¨è€…æŒ¥æ‰‹ (wave)ğŸ‘‹ğŸ»Â çš„æ¬¡æ•°ã€‚

```solidity
//   ./contracts/WavePortal.sol

// SPDX-License-Identifier: UNLICENSED

pragma solidity ^0.8.4;

import "hardhat/console.sol";

contract WavePortal {
    uint256 totalWaves;

    constructor() {
        console.log("Yo yo, I am a contract and I am smart");
    }

    function wave() public {
        totalWaves += 1;

        // è°ƒç”¨å‡½æ•°çš„äººçš„é’±åŒ…åœ°å€
        console.log("%s has waved!", msg.sender);
    }

    function getTotalWaves() public view returns (uint256) {
        console.log("We have %d total waves!", totalWaves);
        return totalWaves;
    }
}
```

åŒæ­¥ä¿®æ”¹ `run.js`

```jsx
//  ./scripts/run.js

const main = async () => {
  // VS Code ä¼šè‡ªåŠ¨ import hre.ethers
  const [owner, randomPerson] = await hre.ethers.getSigners();
  const waveContractFactory = await hre.ethers.getContractFactory("WavePortal");
  const waveContract = await waveContractFactory.deploy();
  await waveContract.deployed();

  console.log("Contract deployed to:", waveContract.address);
  console.log("Contract deployed by:", owner.address);

  let waveCount;
  //  çœ‹çœ‹æœ‰æ²¡æœ‰äººæŒ¥æ‰‹
  waveCount = await waveContract.getTotalWaves();

  // è‡ªå·±æŒ¥ä¸€æ¬¡
  let waveTxn = await waveContract.wave();
  await waveTxn.wait();

  //  å†çœ‹çœ‹æœ‰æ²¡æœ‰äººæŒ¥æ‰‹ï¼Œæœ‰ä¸€æ¬¡äº†ã€‚
  waveCount = await waveContract.getTotalWaves();
};

const runMain = async () => {
  try {
    await main();
    process.exit(0);
  } catch (error) {
    console.log(error);
    process.exit(1);
  }
};

runMain();
```

> ä¸ºäº†å°†æŸäº›ä¸œè¥¿éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªé’±åŒ…åœ°å€ï¼ Hardhat åœ¨åå°ç¥å¥‡åœ°ä¸ºæˆ‘ä»¬åšè¿™ä»¶äº‹ï¼Œ by ï¼š `const [owner, randomPerson] = await hre.ethers.getSigners();`
> 



**Test other users (è®©å…¶ä»–äººä¹Ÿèƒ½è°ƒç”¨å‡½æ•°ï¼)**

```jsx
//   ./scripts/run.js

const main = async () => {
  const [owner, randomPerson] = await hre.ethers.getSigners();
  const waveContractFactory = await hre.ethers.getContractFactory("WavePortal");
  const waveContract = await waveContractFactory.deploy();
  await waveContract.deployed();

  console.log("Contract deployed to:", waveContract.address);
  console.log("Contract deployed by:", owner.address);

  let waveCount;
  waveCount = await waveContract.getTotalWaves();

  let waveTxn = await waveContract.wave();
  await waveTxn.wait();

  waveCount = await waveContract.getTotalWaves();

  // Attention HERE
  waveTxn = await waveContract.connect(randomPerson).wave();
  await waveTxn.wait();

  waveCount = await waveContract.getTotalWaves();
};

const runMain = async () => {
  try {
    await main();
    process.exit(0);
  } catch (error) {
    console.log(error);
    process.exit(1);
  }
};

runMain();
```



## æœ¬åœ°éƒ¨ç½²ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å¼€å§‹æ„å»ºç½‘ç«™

å½“æ‚¨è¿è¡Œ scripts/run.js æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯

1. åˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬åœ°ä»¥å¤ªåŠç½‘ç»œã€‚

2. éƒ¨ç½²åˆçº¦ã€‚

3. è„šæœ¬ç»“æŸåï¼ŒHardhat ä¼šè‡ªåŠ¨é”€æ¯è¯¥æœ¬åœ°ç½‘ç»œã€‚

æ‰€ä»¥æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªæœ¬åœ°çš„æœåŠ¡å™¨ã€‚

```jsx
cd /my-wave-portal
npx hardhat node
```

æ‰§è¡Œ npx åï¼ŒHardhat ä¸ºæˆ‘ä»¬æä¾›äº† 20 ä¸ªå¸æˆ·ï¼Œå¹¶ä¸ºä»–ä»¬æä¾›äº†å…¨éƒ¨ 10000 ETH

æ–°å»º deploy.jsï¼ŒIt looks super similar toÂ `run.js`

```jsx
//   scripts/deploy.js
const main = async () => {
    const [deployer] = await hre.ethers.getSigners();
    const accountBalance = await deployer.getBalance();
  
    console.log("Deploying contracts with account: ", deployer.address);
    console.log("Account balance: ", accountBalance.toString());
  
    const waveContractFactory = await hre.ethers.getContractFactory("WavePortal");
    const waveContract = await waveContractFactory.deploy();
    await waveContract.deployed();
  
    console.log("WavePortal address: ", waveContract.address);
  };
  
  const runMain = async () => {
    try {
      await main();
      process.exit(0);
    } catch (error) {
      console.log(error);
      process.exit(1);
    }
  };
  
  runMain();
```

ç°åœ¨æˆ‘ä»¬è¦è¿è¡Œä»¥åœ¨æœ¬åœ°éƒ¨ç½²çš„å‘½ä»¤æ˜¯ï¼š

```jsx
$ æ–°å»ºä¸€ä¸ª Terminal
$ npx hardhat run scripts/deploy.js --network localhost

Output :
Deploying contracts with account:  0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
Account balance:  10000000000000000000000
WavePortal address:  0x5FbDB2315678afecb367f032d93F642f64180aa3
```

Sever çš„ log é¡µé¢ï¼š

```jsx
web3_clientVersion (2)
eth_accounts
eth_chainId (2)
eth_getBalance
eth_accounts
eth_blockNumber
eth_chainId (2)
eth_estimateGas
eth_getBlockByNumber
eth_feeHistory
eth_sendTransaction
  Contract deployment: WavePortal
  Contract address:    0x5fbdb2315678afecb367f032d93f642f64180aa3
  Transaction:         0x67b70ba926729db02394ce581ec46acf40412cd1d51849753cabdd93f6ffc37a
  From:                0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266
  Value:               0 ETH
  Gas used:            355200 of 355200
  Block #1:            0x04d0b2446404ea561895006b424d9a2431d1338e94f18fb54da854ac26e62b8d

  console.log:
    Yo yo, I am a contract and I am smart

eth_chainId
eth_getTransactionByHash
eth_chainId
eth_getTransactionReceipt
```



## Setup a React appï¼Œè®¾ç½® Metamask

> æ²¡ç”¨è¿™ç©æ„ï¼Œç›´æ¥åœ¨æœ¬åœ°èµ·çš„ React ã€‚

äº†è§£å‰ç«¯å¦‚ä½•ä¸æˆ‘ä»¬çš„åˆçº¦äº¤äº’ï¼

ä½¿ç”¨ [Replit](https://replit.com/~) æ¥æ„å»ºå‰ç«¯ç«™ç‚¹ï¼š å®ƒæ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„ IDEï¼Œå¯è®©æˆ‘ä»¬è½»æ¾æ„å»º Web åº”ç”¨ç¨‹åºå¹¶ä»æµè§ˆå™¨ä¸­éƒ¨ç½²å®ƒä»¬(é¢„è§ˆ React ä»£ç çš„æ•ˆæœ)

<img src="http://imagesoda.oss-cn-beijing.aliyuncs.com/Sodaoo/2022-05-08-Untitled.png" style="zoom: 33%;" />

å¯ä»¥ç›´æ¥åœ¨è¿™é‡Œ Fork ï¼š [https://replit.com/@adilanchian/waveportal-starter-project?v=1](https://replit.com/@adilanchian/waveportal-starter-project?v=1)

ç‚¹å‡» Forkï¼Œç‚¹å‡» Runï¼Œä¸€æ—¦å®ƒåœæ­¢åŠ è½½å¹¶å‘æ‚¨æ˜¾ç¤ºä¸€äº›ä»£ç ï¼Œè¯·å•å‡»é¡¶éƒ¨çš„â€œè¿è¡Œâ€æŒ‰é’®ã€‚ç¬¬ä¸€æ¬¡è¿™å¯èƒ½éœ€è¦ 2-3 åˆ†é’Ÿã€‚åŸºæœ¬ä¸Šï¼ŒReplit æ­£åœ¨å¯åŠ¨æ‚¨çš„é¡¹ç›®å¹¶å°†å…¶éƒ¨ç½²åˆ°å®é™…åŸŸã€‚

> **In Replit, if you are creating any new JavaScript files, you will need to use theÂ `.jsx`Â extension instead! Replit has some performance fanciness that requires you use theÂ `.jsx`Â file extension :).**
> 

ç›´æ¥ Download git ï¼ˆ[https://github.com/buildspace/waveportal-starter-project](https://github.com/buildspace/waveportal-starter-project)ï¼‰ ï¼š

1. RunÂ `npm install`Â at the root of your directory
2. RunÂ `npm run start`Â to start the project

React é¦–æ¬¡å¯åŠ¨æœ‰ç‚¹æ…¢ï¼Œå¤§æ¦‚ç­‰ 10 s å·¦å³ï¼š

![](http://imagesoda.oss-cn-beijing.aliyuncs.com/Sodaoo/2022-05-08-Untitled%201.png)



## Alchemy

åœ¨ AlchemyÂ [here](https://alchemy.com/?r=b93d1f12b8828a57) åˆ›å»ºè´¦æˆ·ï¼Œä»¥ä¾¿äº¤äº’åˆ° BlockChain ç½‘ç»œã€‚

å½“æˆ‘ä»¬éƒ¨ç½²åˆçº¦æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰æ‰€æœ‰è¿™äº›çŸ¿å·¥ï¼Œâ€œå˜¿ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦ï¼Œè¯·å°†æˆ‘çš„æ™ºèƒ½åˆçº¦æ·»åŠ åˆ°åŒºå—é“¾ä¸­ï¼Œç„¶åä¹Ÿå‘Šè¯‰å…¶ä»–äººâ€ã€‚

è¿™å°±æ˜¯ Alchemy ï¼ˆç‚¼é‡‘æœ¯ï¼‰çš„ç”¨æ­¦ä¹‹åœ°ã€‚

Alchemy æœ¬è´¨ä¸Šå¸®åŠ©æˆ‘ä»¬å¹¿æ’­æˆ‘ä»¬çš„åˆçº¦åˆ›å»ºäº¤æ˜“ï¼Œä»¥ä¾¿å®ƒå¯ä»¥è¢«çŸ¿å·¥å°½å¿«æ‹¾å–ã€‚ä¸€æ—¦äº¤æ˜“è¢«æŒ–æ˜å‡ºæ¥ï¼Œå®ƒå°±ä¼šä½œä¸ºåˆæ³•äº¤æ˜“è¢«å¹¿æ’­åˆ°åŒºå—é“¾ä¸Šã€‚ä»é‚£é‡Œï¼Œæ¯ä¸ªäººéƒ½ä¼šæ›´æ–°ä»–ä»¬çš„åŒºå—é“¾å‰¯æœ¬ã€‚

1. Create APP 
2. é€‰æ‹©é ETH ç½‘ç»œï¼Œæˆ‘ä»¬å°†ä»ä»¥å¤ªåŠåŸºé‡‘ä¼šçš„â€œRinkeby æµ‹è¯•ç½‘â€å¼€å§‹ï¼Œå®ƒæ˜¯â€œä¸»ç½‘â€çš„å…‹éš†ï¼Œä½†å®ƒä½¿ç”¨å‡ $ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°½å¯èƒ½å¤šåœ°æµ‹è¯•ä¸œè¥¿ã€‚
3. åˆ›å»ºåæ¥åˆ° Dashboardï¼Œç‚¹å‡» view key æŸ¥çœ‹

æˆ‘ä»¬å¯ä»¥åœ¨å®é™…åœºæ™¯ä¸­æµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼š

1. å¹¿æ’­æˆ‘ä»¬çš„äº¤æ˜“
2. ç­‰å¾…å®é™…çŸ¿å·¥é¢†å–
3. ç­‰å¾…å®ƒè¢«å¼€é‡‡
4. ç­‰å¾…å®ƒè¢«å¹¿æ’­å›åŒºå—é“¾ï¼Œå‘Šè¯‰æ‰€æœ‰å…¶ä»–çŸ¿å·¥æ›´æ–°ä»–ä»¬çš„å‰¯æœ¬

ä¸ºäº†è·å¾—å‡ ETHï¼Œæˆ‘ä»¬å¿…é¡»å‘ç½‘ç»œç´¢å–ä¸€äº›ã€‚è¿™ä¸ªå‡çš„ ETH åªèƒ½åœ¨è¿™ä¸ªç‰¹å®šçš„æµ‹è¯•ç½‘ä¸Šå·¥ä½œã€‚

- [https://faucets.chain.link/rinkeby](https://faucets.chain.link/rinkeby)
    - è¿™ä¸ªç½‘ç«™å¯ä»¥è·å¾— 0.1 ETH

MetaMask æ·»åŠ  Rinkeby æµ‹è¯•ç½‘ï¼š

1. Go  [https://chainlist.org/](https://chainlist.org/)
2. toggle Testnets Button
3. Search â€œRinkebyâ€
4. Connect 

> éƒ¨åˆ† MetaMask é’±åŒ…å¥½åƒè‡ªå¸¦ Rinkeby æµ‹è¯•ç½‘ï¼Œå°±ä¸ç”¨æ·»åŠ äº†ã€‚
> 

### **Deploy to Rinkeby testnet**

```jsx
//   hardhat.config.js  ä¿®æ”¹
//  è¿™æ ·å¾ˆå±é™©ï¼Œåé¢è¯´æ˜

require("@nomiclabs/hardhat-waffle");

module.exports = {
  solidity: "0.8.4",
  networks: {
    rinkeby: {
      url: "YOUR_ALCHEMY_API_URL",
      accounts: ["YOUR_PRIVATE_RINKEBY_ACCOUNT_KEY"]
    },
  },
};
```

> Noteï¼š æ­¤ç§é’¥ä¸æ‚¨çš„ä¸»ç½‘ç§é’¥ç›¸åŒï¼Œ **DON'T COMMIT THIS FILE TO GITHUB**
> 

æœ€å¥½çš„æ–¹æ³•æ˜¯å°† hardhat é…ç½®æ–‡ä»¶æ·»åŠ åˆ° .gitignore ï¼Œä»è€Œé¿å… upload ã€‚ **

å¦ä¸€ç§ä¿è¯ hardhat.config.js å®‰å…¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨ dotenv ï¼ˆ å®‰è£…ï¼š `npm i --save dotenv` ï¼‰ï¼š

```jsx
//   hardhat.config.js  ä¿®æ”¹
// ä½¿ç”¨ dotenv,  é¿å… upload hardhat.config.js
require("@nomiclabs/hardhat-waffle");

// Import and configure dotenv
require("dotenv").config();

module.exports = {
  solidity: "0.8.4",
  networks: {
    rinkeby: {
      // This value will be replaced on runtime
      url: process.env.STAGING_ALCHEMY_KEY,
      accounts: [process.env.PRIVATE_KEY],
    },
    mainnet: {
      chainId: 1,
      url: process.env.PROD_ALCHEMY_KEY,
      accounts: [process.env.PRIVATE_KEY],
    },
  },
};
```

åœ¨ root æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª .env æ–‡ä»¶å¹¶æ·»åŠ æ‚¨çš„ secrets ï¼š

```jsx
STAGING_ALCHEMY_KEY=REPLACE_WITH_ACTUAL_ALCHEMY_URL  // HTTPï¼š https://eth-rinkeby.alchemyapi.io...
PROD_ALCHEMY_KEY=BLAHBLAH  // API Key : UCT.........
PRIVATE_KEY=BLAHBLAH       // ç§é’¥
```

æœ€åï¼Œå°† .env æ–‡ä»¶æ·»åŠ åˆ°æ‚¨çš„ .gitignore æ–‡ä»¶ä¸­ (ä¸€èˆ¬ `.env`  é»˜è®¤åœ¨ `.gitignore` é‡Œé¢)

> ç§é’¥å¯ä»¥åœ¨ MetaMask å¯¼å‡º ï¼š ã€Œ ä¸‰ç‚¹ - è´¦æˆ·è¯¦æƒ… - å¯¼å‡ºç§é’¥ã€
> 

ä¸ºä»€ä¹ˆéœ€è¦ç§é’¥ï¼Ÿ

> å› ä¸ºä¸ºäº†æ‰§è¡Œåƒéƒ¨ç½²åˆçº¦è¿™æ ·çš„äº¤æ˜“ï¼Œéœ€è¦ "loginâ€ åˆ°åŒºå—é“¾ã€‚è€Œä¸”ï¼Œæ‚¨çš„ç”¨æˆ·åæ˜¯æ‚¨çš„å…¬å…±åœ°å€ï¼Œæ‚¨çš„å¯†ç æ˜¯æ‚¨çš„ç§é’¥ã€‚è¿™æœ‰ç‚¹åƒç™»å½• AWS æˆ– GCP è¿›è¡Œéƒ¨ç½²ã€‚
> 

ä¸€æ—¦ä½ å®Œæˆäº†é…ç½®è®¾ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰ç¼–å†™çš„éƒ¨ç½²è„šæœ¬è¿›è¡Œéƒ¨ç½²ã€‚ä» my-wave-portal çš„æ ¹ç›®å½•è¿è¡Œæ­¤å‘½ä»¤ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ‰€åšçš„åªæ˜¯å°†å…¶ä» localhost æ›´æ”¹ä¸º rinkebyï¼š

```jsx
npx hardhat run scripts/deploy.js --network rinkeby

Output :
Deploying contracts with account:  0x65d5b68A7878A987e7A19826A7f9Aa6F5F92e10F
Account balance:  100000000000000000
WavePortal address:  0xC73BC1952694D49AfbB82563aD8D2780132F9F2D  (åˆçº¦åœ°å€)
```

å¯ä»¥åœ¨ [https://rinkeby.etherscan.io/](https://rinkeby.etherscan.io/) æŸ¥çœ‹éƒ¨ç½²åœ¨ Rinkeby ä¸Šçš„ Smart Contract åœ°å€ï¼š

![](http://imagesoda.oss-cn-beijing.aliyuncs.com/Sodaoo/2022-05-08-Untitled%202.png)



## React Connect Wallet

ä¸€æ—¦æˆ‘ä»¬å°†é’±åŒ…è¿æ¥åˆ°æˆ‘ä»¬çš„ç½‘ç«™ï¼Œæˆ‘ä»¬çš„ç½‘ç«™å°†æœ‰æƒä»£è¡¨æˆ‘ä»¬è°ƒç”¨æ™ºèƒ½åˆçº¦ã€‚

MetaMask çš„ **window** å±æ€§ï¼š

> when MetaMask is installed, the window object has anÂ `ethereum`
Â property to interact with (äº¤äº’) .  When you call this function, your MetaMask extension should open and ask what account you would like to connect to.
> 

> å½“æ‚¨è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œæ‚¨çš„ MetaMask æ‰©å±•ç¨‹åºåº”è¯¥æ‰“å¼€å¹¶è¯¢é—®æ‚¨è¦è¿æ¥åˆ°å“ªä¸ªå¸æˆ·ã€‚
> 

> ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬çš„æµè§ˆå™¨ç™»å½•åˆ°äº† Metamaskï¼Œå®ƒä¼šè‡ªåŠ¨å°†ä¸€ä¸ªåä¸º `ethereum` çš„ç‰¹æ®Šå¯¹è±¡æ³¨å…¥æˆ‘ä»¬çš„çª—å£ï¼ˆwindowï¼‰,å¯ä»¥é€šè¿‡ `window.ethereum` è°ƒç”¨ã€‚
> 

- ethereum çš„ eth_accounts æ–¹æ³•æŸ¥çœ‹æ˜¯å¦æœ‰æƒè®¿é—®ç”¨æˆ·é’±åŒ…ä¸­çš„å¸æˆ·ã€‚
- ethereum çš„ eth_requestAccounts æ–¹æ³•æ˜¯å»ºç«‹åˆå§‹è¿æ¥ MetaMask çš„å‡½æ•°ã€‚

```jsx
//   frontend/src/App.js
import './App.css';
import React, { useEffect,useState } from "react";

const App = () => {
  // useState èµ‹ "" çš„åˆå§‹å€¼ç»™ currentAccountï¼Œä½¿ç”¨ setCurrentAccount å¯¹ currentAccount çš„ value è¿›è¡Œæ›´æ”¹
  // å½“æˆ‘ä»¬è¿æ¥åˆ° MetaMask å‰ï¼ŒuseStateä¸ºç©ºï¼Œ
  // å½“æˆ‘ä»¬è¿æ¥åˆ° MetaMask åï¼ŒuseStateä¸ºé¦–ä¸ªè´¦å·åœ°å€ ~
  const [currentAccount, setCurrentAccount] = useState("");

  const checkIfWalletIsConnected = async () => {
    try {
      const { ethereum } = window;   // è§£åŒ…å¯¹è±¡

      if (!ethereum) {
        console.log("Make sure you have metamask!");  // è§£åŒ…å‡ºæ¥ä¸ºç©ºï¼Œè¯´æ˜æ²¡æœ‰å®‰è£…(ç™»å½•)é’±åŒ…
        return;
      } else {
        console.log("We have the ethereum object", ethereum);
      }

      // ä½¿ç”¨ç‰¹æ®Šæ–¹æ³• eth_accounts æŸ¥çœ‹æ˜¯å¦æœ‰æƒè®¿é—®ç”¨æˆ·é’±åŒ…ä¸­çš„å¸æˆ·ã€‚(ç”¨æˆ·é’±åŒ…ä¸­å¯èƒ½æœ‰å¤šä¸ªå¸æˆ·, è¿™é‡Œå– No.1 ä¸ª)
      const accounts = await ethereum.request({ method: "eth_accounts" });

      if (accounts.length !== 0) {
        const account = accounts[0];
        console.log("Found an authorized account:", account);
        setCurrentAccount(account);
      } else {
        console.log("No authorized account found")
      }
    } catch (error) {
      console.log(error);
    }
  }

  /**  Implement your connectWallet method here  */
  const connectWallet = async () => {
    try {
      const { ethereum } = window;

      if (!ethereum) {
        alert("Get MetaMask!");
        return;
      }

      // eth_requestAccounts æ˜¯å»ºç«‹åˆå§‹è¿æ¥ MetaMask çš„å‡½æ•°ã€‚
      const accounts = await ethereum.request({ method: "eth_requestAccounts" });

      console.log("Connected", accounts[0]);
      setCurrentAccount(accounts[0]);
    } catch (error) {
      console.log(error)
    }
  }

  // This runs our function when the page loads.
  useEffect(() => {
    checkIfWalletIsConnected();
  }, [])

  return (
    <div className="mainContainer">
      <div className="dataContainer">
        <div className="header">
        ğŸ‘‹ Hey there!
        </div>

        <div className="bio">
          I am farza and I worked on self-driving cars so that's pretty cool right? Connect your Ethereum wallet and wave at me!
        </div>

        <button className="waveButton" onClick={null}>
          Wave at Me
        </button>

        {/*
        * currentAccount æ˜¯ checkIfWalletIsConnected è¿”å›çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡æ ‡è¯†äº†å½“å‰æ˜¯å¦è¿æ¥åˆ°äº† Walletã€‚
          1. If there is no currentAccount render this buttonã€‚
          2. å¦‚æœè¿æ¥åˆ°äº† Walletï¼Œå°±ä¸ render this buttonã€‚ 
        */}
        {!currentAccount && (
          <button className="waveButton" onClick={connectWallet}>
            Connect Wallet
          </button>
        )}
      </div>
    </div>
  );
}

export default App
```

<img src="http://imagesoda.oss-cn-beijing.aliyuncs.com/Sodaoo/2022-05-08-Untitled%203.png" style="zoom: 33%;" />

ç‚¹å‡» Connect åï¼š

![](http://imagesoda.oss-cn-beijing.aliyuncs.com/Sodaoo/2022-05-08-Untitled%204.png)



## React calls Contract

`ethers.providers` : `providers` is an abstraction of a connection to the Ethereum networkï¼Œä¸ºstandard Ethereum node functionality (æ ‡å‡†ä»¥å¤ªåŠèŠ‚ç‚¹åŠŸèƒ½) æä¾›ç®€æ´ã€ä¸€è‡´çš„æ¥å£ã€‚

`signer` : `ethers.signer` is an abstraction of an Ethereum Accountï¼Œå¯ç”¨äºå¯¹æ¶ˆæ¯å’Œäº¤æ˜“è¿›è¡Œç­¾åï¼Œå¹¶å°†ç­¾åçš„äº¤æ˜“å‘é€åˆ°ä»¥å¤ªåŠç½‘ç»œä»¥æ‰§è¡ŒçŠ¶æ€æ›´æ”¹æ“ä½œã€‚ about [signer](https://docs.ethers.io/v5/api/signer/#signers)

`ABI`ï¼ˆApplication Binary Interfaceï¼‰ : ç¼–è¯‘ä¸€ä¸ªåˆçº¦æ—¶ï¼Œä¼šåœ¨ workspace ä¸‹åˆ›å»ºä¸€å †æ–‡ä»¶ï¼ŒABI å°±æ˜¯è¿™äº›æ–‡ä»¶ä¹‹ä¸€ã€‚

ABI åœ°å€ï¼š`${workspace}/artifacts/contracts/WavePortal.sol/WavePortal.json` ä¸­

å°†è¿™ä¸ªæ–‡ä»¶ Copy åˆ° Frontend ï¼š `./src/utils/WavePortal.json` 

> ABI :  EVMï¼ˆä»¥å¤ªåŠè™šæ‹Ÿæœºï¼‰æ˜¯ä»¥å¤ªåŠç½‘ç»œçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ™ºèƒ½åˆçº¦æ˜¯å­˜å‚¨åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„ä»£ç ç‰‡æ®µï¼Œåœ¨ EVM ä¸Šæ‰§è¡Œã€‚ç”¨ Solidity æˆ– Vyper ç­‰é«˜çº§è¯­è¨€ç¼–å†™çš„æ™ºèƒ½åˆçº¦éœ€è¦ç¼–è¯‘æˆ EVM å¯æ‰§è¡Œå­—èŠ‚ç ï¼›éƒ¨ç½²æ™ºèƒ½åˆçº¦æ—¶ï¼Œæ­¤å­—èŠ‚ç å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šå¹¶ä¸åœ°å€ç›¸å…³è”ã€‚å¯¹äºä»¥å¤ªåŠå’Œ EVMï¼Œæ™ºèƒ½åˆçº¦å°±æ˜¯è¿™ä¸ªå­—èŠ‚ç åºåˆ—ã€‚è¦è®¿é—®ç”¨é«˜çº§è¯­è¨€å®šä¹‰çš„å‡½æ•°ï¼Œç”¨æˆ·éœ€è¦å°†åç§°å’Œå‚æ•°è½¬æ¢ä¸ºå­—èŠ‚è¡¨ç¤ºï¼Œä»¥ä¾¿å­—èŠ‚ç ä½¿ç”¨å®ƒã€‚ä¸ºäº†è§£é‡Šå“åº”ä¸­å‘é€çš„å­—èŠ‚ï¼Œç”¨æˆ·éœ€è¦è½¬æ¢å›ç”¨é«˜çº§è¯­è¨€å®šä¹‰çš„è¿”å›å€¼å…ƒç»„ã€‚ä¸º EVM ç¼–è¯‘çš„è¯­è¨€å¯¹è¿™äº›è½¬æ¢ä¿æŒä¸¥æ ¼çš„çº¦å®šï¼Œä½†ä¸ºäº†æ‰§è¡Œå®ƒä»¬ï¼Œå¿…é¡»çŸ¥é“ä¸æ“ä½œç›¸å…³çš„ç²¾ç¡®åç§°å’Œç±»å‹ã€‚ **ABI ç²¾ç¡®åœ°è®°å½•äº†è¿™äº›åç§°å’Œç±»å‹ï¼Œæ˜“äºè§£æçš„æ ¼å¼**ï¼Œåœ¨äººä¸ºçš„æ–¹æ³•è°ƒç”¨å’Œå¯å‘ç°ä¸”å¯é çš„æ™ºèƒ½åˆçº¦æ“ä½œä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚
> 

```jsx
//  src/App.js

import React, { useEffect, useState } from "react";
import { ethers } from "ethers";
import './App.css';
import abi from './utils/WavePortal.json';

const App = () => {
  const [currentAccount, setCurrentAccount] = useState("");

  // éƒ¨ç½²çš„åˆçº¦çš„åœ°å€  ï¼ˆ  WavePortal address:  0xC73BC1952694D49AfbB82563aD8D2780132F9F2D
  const contractAddress = "0xC73BC1952694D49AfbB82563aD8D2780132F9F2D";
  const contractABI = abi.abi;
  
  const checkIfWalletIsConnected = async () => {
    try {
      const { ethereum } = window;

      if (!ethereum) {
        console.log("Make sure you have metamask!");
        return;
      } else {
        console.log("We have the ethereum object", ethereum);
      }

      const accounts = await ethereum.request({ method: 'eth_accounts' });

      if (accounts.length !== 0) {
        const account = accounts[0];
        console.log("Found an authorized account:", account);
        setCurrentAccount(account)
      } else {
        console.log("No authorized account found")
      }
    } catch (error) {
      console.log(error);
    }
  }

  const connectWallet = async () => {
    try {
      const { ethereum } = window;

      if (!ethereum) {
        alert("Get MetaMask!");
        return;
      }

      const accounts = await ethereum.request({ method: "eth_requestAccounts" });

      console.log("Connected", accounts[0]);
      setCurrentAccount(accounts[0]); 
    } catch (error) {
      console.log(error)
    }
  }

  const wave = async () => {
    try {
      const { ethereum } = window;

      if (ethereum) {
        const provider = new ethers.providers.Web3Provider(ethereum);
        const signer = provider.getSigner();
        const wavePortalContract = new ethers.Contract(contractAddress, contractABI, signer);

        let count = await wavePortalContract.getTotalWaves();
        console.log("Retrieved total wave count...", count.toNumber());

        // è°ƒç”¨åˆçº¦é‡Œçš„ wave() å‡½æ•°ï¼Œè¿˜è®°å¾—å—ï¼Œwave() ä¸­æœ‰ä¸€ä¸ª variable ï¼štotalWaves += 1;
        // åˆçº¦çš„ wave() æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ‘ç†è§£è¿™é‡Œçš„ waveTxn æ˜¯ Promise çš„è§£æå€¼ï¼ˆresolved valueï¼‰
        const waveTxn = await wavePortalContract.wave();
        console.log("Mining...", waveTxn.hash);  // æ‰“å° hash value

        // waveTxn èƒ½è°ƒç”¨ wait() è¯´æ˜å·²ç»æ‰§è¡Œå®Œæ¯•äº†ï¼Œæ­¤æ—¶å·² Mint å®Œæ¯•ã€‚
        // console.log(waveTxn) çœ‹äº†ä¸€ä¸‹ï¼Œä¸æ˜¯ await çš„é€šç”¨å¯¹è±¡ï¼Œè€Œæ˜¯åˆçº¦è¿”å›çš„æŸç§å¯¹è±¡ï¼Œæ‰€ä»¥æ‰æœ‰ wait() è¿™ä¸ªå‡½æ•°ï¼Œæ€ªä¸å¾—æˆ‘æ²¡æœåˆ°ã€‚ã€‚ã€‚
        await waveTxn.wait();
        console.log("Mined -- ", waveTxn.hash);

        // å†çœ‹çœ‹ç›®å‰çš„å–å›çš„ æŒ¥æ‰‹æ•° æ˜¯å¤šå°‘ã€‚
        count = await wavePortalContract.getTotalWaves();
        console.log("Retrieved total wave count...", count.toNumber());
      } else {
        console.log("Ethereum object doesn't exist!");
      }
    } catch (error) {
      console.log(error)
    }
  }
  
  // React hook, [] æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦‚æœ [] å†…çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œåˆ™æ‰§è¡Œ checkIfWalletIsConnected
  // å› ä¸º [] æ˜¯ç©ºæ•°ç»„ï¼Œä¸ä¼šå˜ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚
  useEffect(() => {
    checkIfWalletIsConnected();
  }, [])
  
  return (
    <div className="mainContainer">
      <div className="dataContainer">
        <div className="header">
        ğŸ‘‹ Hey there!
        </div>

        <div className="bio">
          I am farza and I worked on self-driving cars so that's pretty cool right? Connect your Ethereum wallet and wave at me!
        </div>

        // ç‚¹å‡» è§¦å‘ wave å‡½æ•°ï¼ŒtotalWaves += 1; ï¼ˆå†™åœ¨åˆçº¦é‡Œçš„ï¼Œ è¿™ä¸ªå‚æ•°ä¼šè¢«ä¿å­˜åˆ°é“¾ä¸Šï¼‰
        <button className="waveButton" onClick={wave}>
          Wave at Me
        </button>

        {!currentAccount && (
          <button className="waveButton" onClick={connectWallet}>
            Connect Wallet
          </button>
        )}
      </div>
    </div>
  );
}

export default App
```

All code ï¼š [https://gist.github.com/adilanchian/71890bf4fcd8f78e94c77cf694b24659](https://gist.github.com/adilanchian/71890bf4fcd8f78e94c77cf694b24659)

æ³¨æ„ï¼š

- è¯»å–åˆçº¦é‡Œçš„ variable æ˜¯ä¸éœ€è¦ Gas çš„
- ä½†æ˜¯ä¿®æ”¹åˆçº¦ä¸­çš„ variable ï¼ˆtotalWavesï¼‰æ˜¯å¯¹åŒºå—çš„ä¿®æ”¹ï¼Œäº¤æ˜“éœ€è¦çŸ¿å·¥ç¡®è®¤ï¼ˆthe transaction can be minedï¼‰ï¼Œæ‰€ä»¥éœ€è¦ gas è´¹ã€‚
- åœ¨äº¤æ˜“è¢« mined æ—¶ï¼Œæ‚¨å®é™…ä¸Šå¯ä»¥æ‰“å°å‡ºäº¤æ˜“å“ˆå¸Œï¼Œå°†å…¶å¤åˆ¶/ç²˜è´´åˆ° Etherscanï¼Œå¹¶å®æ—¶æŸ¥çœ‹å®ƒçš„å¤„ç†è¿‡ç¨‹

### QAï¼š

åœ¨ js ä¸­èª¿ç”¨åˆç´„æœ‰å¹¾å€‹å¯ä»¥ç•™æ„çš„äº‹æƒ…:

1. è¿™ä¸ªå‡½æ•°äº§ç”Ÿäº¤æ˜“
  1a.è¿™ä¸ªå‡½æ•°ä¹Ÿè¿”å›å€¼ -  æœ‰äº§ç”Ÿäº¤æ˜“çš„å‡½æ•°å¦‚æœæœ‰è¿”å›å€¼, å…¶ä»–åˆçº¦å¯ä»¥ä½¿ç”¨è¿™ä¸ªè¿”å›å€¼ (in solidtiy) ä½†åœ¨ js è¿™ç«¯ä¸ä¼šæ‹¿åˆ°è¿™ä¸ªå€¼, æˆ‘ä»¬åªä¼šæ‹¿åˆ°è¿™ä¸ªäº¤æ˜“, ä½ å‰é¢æåˆ°çš„è¿™ä¸ª "æŸç§å¯¹è±¡" å°±æ˜¯æ‰€è°“çš„ receipt (æ”¶æ®), åœ¨ typescript ä»–æ˜¯ TransactionResponse, è¿™ä¸ªç±»å‹ä¼šå­˜åœ¨ wait å‡½æ•°, æ¥å£å¯ä»¥çœ‹çœ‹:

[https://docs.ethers.io/v5/api/providers/types/#providers-TransactionResponse](https://docs.ethers.io/v5/api/providers/types/#providers-TransactionResponse)

1b. è¿™ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼ - æ²¡æœ‰é—®é¢˜, js ç«¯ä»ç„¶åªä¼šæ”¶åˆ° receipt
æ‰€ä»¥åœ¨ js ä¸­å¦‚æœæˆ‘ä»¬è¦çœ‹å‡½æ•°è°ƒç”¨, æœ€å®‰å…¨çš„æ–¹å¼è¿˜æ˜¯ä¸æ–­çš„çœ‹ event , ä» event çœ‹ä¸€äº› log æ¯”è¾ƒå¥½

2. è¿™ä¸ªå‡½æ•°æ²¡æœ‰äº§ç”Ÿäº¤æ˜“
2a. è¿™ä¸ªå‡½æ•°æœ‰è¿”å›å€¼ - å¦‚æœè¿™ä¸ªå‡½æ•°æ˜¯é™æ€æ²¡æœ‰æ”¹å˜çŠ¶æ€, é‚£å°±ä¼šè¿”å›åˆçº¦ä¸­çš„å‡½æ•°, ä½ çš„ wave å› ä¸ºæœ‰æ”¹åŠ¨åˆ°çŠ¶æ€, å°±ä¸ç¬¦åˆ callStatic çš„éœ€æ±‚ï¼š

[https://docs.ethers.io/v5/api/contract/contract/#contract-callStatic](https://docs.ethers.io/v5/api/contract/contract/#contract-callStatic)

2b. è¿™ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼ - ä¸€æ ·åªä¼šæ‹¿åˆ° receipt

ä¸çŸ¥é“è¿™æ ·æœ‰æ²¡æœ‰æ¸…æ¥š~~

> ç»™å¤§ä½¬è·ªäº†
> 

Alex ï¼š é“¾ä¸Šäº¤äº’å…¨éƒ¨éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œweb3jsè¿”å›çš„éƒ½æ˜¯promiseã€‚

æ²¡æœ‰å·®åˆ«çš„ï¼Œåº•å±‚éƒ½æ˜¯ä¸€æ ·ï¼Œéƒ½æ˜¯json rpcï¼Œabi encodeå‚æ•°è€Œå·²ã€‚



## Storing messages from users on the blockchain

å¸Œæœ›æˆ‘ä»¬çš„ APP ç»§ç»­æ·»åŠ ä»¥ä¸‹åŠŸèƒ½ï¼š

1. Let users submit a message to blockchain
2. Have that data saved somehow on the blockchain.
3. åœ¨ç½‘ç«™ä¸Šæ˜¾ç¤ºè¿™äº›æ•°æ®ï¼Œä»¥ä¾¿ä»»ä½•äººéƒ½å¯ä»¥çœ‹åˆ°å‘æˆ‘ä»¬æŒ¥æ‰‹çš„äººã€Their Messageã€Commentã€‚

Solidity Events ï¼š

> åœ¨ä»‹ç» Events å‰ï¼Œæˆ‘ä»¬å…ˆæ˜ç¡® Events ï¼Œæ—¥å¿—è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚Events å‘ç”Ÿåè¢«è®°å½•åˆ°åŒºå—é“¾ä¸Šæˆä¸ºäº†æ—¥å¿—ã€‚æ€»çš„æ¥è¯´ï¼ŒEvents å¼ºè°ƒåŠŸèƒ½ï¼Œä¸€ç§è¡Œä¸ºï¼› æ—¥å¿—å¼ºè°ƒå­˜å‚¨ï¼Œå†…å®¹ã€‚
> 

> Events æ˜¯ä»¥å¤ªåŠ EVM æä¾›çš„ä¸€ç§æ—¥å¿—åŸºç¡€è®¾æ–½ã€‚Events å¯ä»¥ç”¨æ¥åšæ“ä½œè®°å½•ï¼Œå­˜å‚¨ä¸ºæ—¥å¿—ã€‚ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ä¸€äº›äº¤äº’åŠŸèƒ½ï¼Œæ¯”å¦‚é€šçŸ¥UIï¼Œè¿”å›å‡½æ•°è°ƒç”¨ç»“æœç­‰
> 

> Emit å…³é”®å­—ç”¨äºåœ¨solidity ä¸­å‘å‡ºï¼ˆå‘å°„ï¼‰ä¸€ä¸ª Eventsï¼Œè¯¥ Events å¯ä»¥è¢« Dapp ä¸­çš„å®¢æˆ·ç«¯è¯»å–ã€‚Solidity äº‹ä»¶ç”¨äºè®°å½•åŒºå—é“¾ä¸­å‘ç”Ÿçš„äº¤æ˜“ã€‚
> 

```jsx
//   ./contracts/WavePortal.sol

// SPDX-License-Identifier: UNLICENSED

pragma solidity ^0.8.4;

import "hardhat/console.sol";

contract WavePortal {
    uint256 totalWaves;

    // Declare an Event
    event NewWave(address indexed from, uint256 timestamp, string message);

    // ç”¨æˆ·å‘é€ Message ç»™æˆ‘ä»¬çš„ struct ç»“æ„ã€‚
    struct Wave {
        address waver;     // The address of the user who waved.
        string message;    // The message the user sent.
        uint256 timestamp; // The timestamp
    }

    // an array of structs.
    Wave[] waves;

    constructor() {     console.log("I AM SMART CONTRACT. POG.");     }

    /*  _message æ˜¯ Users å‘ç»™ Contract çš„æ¶ˆæ¯  */
    function wave(string memory _message) public {
        totalWaves += 1;
        console.log("%s waved w/ message %s", msg.sender, _message);
        /* æœ‰äººè°ƒç”¨ wave()ï¼Œ å°± push ä¿¡æ¯åˆ°æ•°ç»„é‡Œé¢ */
        waves.push(Wave(msg.sender, _message, block.timestamp));

        /*  å‰é¢ Event å£°æ˜äº† NewWaveï¼Œç°åœ¨è®©æˆ‘ä»¬æäº¤(å‘å°„)å®ƒ ! */
        emit NewWave(msg.sender, block.timestamp, _message);
    }

    /* retrieve the waves from our website!  */
    function getAllWaves() public view returns (Wave[] memory) {
        return waves;
    }

    function getTotalWaves() public view returns (uint256) {
        // Optional: Add this line if you want to see the contract print the value!
        // We'll also print it over in run.js as well.
        console.log("We have %d total waves!", totalWaves);
        return totalWaves;
    }
}
```

updatedÂ `run.js`

```jsx
//  ./scripts/run.js

const main = async () => {
    const waveContractFactory = await hre.ethers.getContractFactory("WavePortal");
    const waveContract = await waveContractFactory.deploy();
    await waveContract.deployed();
    console.log("Contract addy:", waveContract.address);
  
    let waveCount;
    waveCount = await waveContract.getTotalWaves();
    console.log(waveCount.toNumber());
  
    /** Let's send a few waves!  */
    let waveTxn = await waveContract.wave("A message!");
    await waveTxn.wait();  // Wait for the transaction(äº¤æ˜“) to be mined
  
    const [_, randomPerson] = await hre.ethers.getSigners();
    waveTxn = await waveContract.connect(randomPerson).wave("Another message!");
    await waveTxn.wait();  // Wait for the transaction(äº¤æ˜“) to be mined
  
    let allWaves = await waveContract.getAllWaves();
    console.log(allWaves);
  };
  
  const runMain = async () => {
    try {
      await main();
      process.exit(0);
    } catch (error) {
      console.log(error);
      process.exit(1);
    }
  };
  
  runMain();
```

```jsx
npx hardhat run scripts/run.js

Output:
Compiled 1 Solidity file successfully
I AM SMART CONTRACT. POG.
Contract addy: 0x5FbDB2315678afecb367f032d93F642f64180aa3
We have 0 total waves!
0
0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 waved w/ message A message!
0x70997970c51812dc3a010c7d01b50e0d17dc79c8 waved w/ message Another message!
[
  [
    '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    'A message!',
    BigNumber { value: "1651842056" },
    waver: '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    message: 'A message!',
    timestamp: BigNumber { value: "1651842056" }
  ],
  [
    '0x70997970C51812dc3A010C7d01b50e0d17dc79C8',
    'Another message!',
    BigNumber { value: "1651842057" },
    waver: '0x70997970C51812dc3A010C7d01b50e0d17dc79C8',
    message: 'Another message!',
    timestamp: BigNumber { value: "1651842057" }
  ]
]
```



### **Re-deploy**

æ—¢ç„¶æˆ‘ä»¬å·²ç»æ›´æ–°äº†åˆçº¦ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›äº‹æƒ…ï¼š

1. We need to deploy it again.

2. We need to update the contract address on our frontend.

3. We need to update the abi file on our frontend.

**People constantly forget to do these 3 steps when they change their contract. Don't forget !**

ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åšè¿™ä¸€åˆ‡ï¼Ÿå—¯ï¼Œè¿™æ˜¯å› ä¸ºæ™ºèƒ½åˆçº¦æ˜¯ä¸å¯å˜çš„ã€‚ä»–ä»¬æ— æ³•æ”¹å˜ã€‚å®ƒä»¬æ˜¯æ°¸ä¹…æ€§çš„ã€‚è¿™æ„å‘³ç€æ›´æ”¹åˆåŒéœ€è¦å®Œå…¨é‡æ–°éƒ¨ç½²ã€‚è¿™ä¹Ÿå°†é‡ç½®æ‰€æœ‰å˜é‡ï¼Œå› ä¸ºå®ƒå°†è¢«è§†ä¸ºå…¨æ–°çš„åˆåŒã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬æƒ³æ›´æ–°åˆçº¦çš„ä»£ç ï¼Œæˆ‘ä»¬ä¼šä¸¢å¤±æ‰€æœ‰çš„ wave æ•°æ®

æ‰€ä»¥ä½ ç°åœ¨éœ€è¦åšçš„æ˜¯ï¼š

1. ä½¿ç”¨ `npx hardhat run scripts/deploy.js --network rinkeby` å†æ¬¡éƒ¨ç½²
2. å°† App.js ä¸­çš„ `contractAddress` æ›´æ”¹ä¸ºæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­é€šè¿‡ä¸Šè¿°æ­¥éª¤è·å¾—çš„æ–°åˆçº¦åœ°å€ï¼Œå°±åƒæˆ‘ä»¬ç¬¬ä¸€æ¬¡éƒ¨ç½²ä¹‹å‰æ‰€åšçš„ä¸€æ ·ã€‚
3. åƒä»¥å‰ä¸€æ ·ä»å·¥ä»¶ä¸­è·å–æ›´æ–°çš„ abi æ–‡ä»¶ï¼Œç„¶ååƒä»¥å‰ä¸€æ ·å°†å…¶å¤åˆ¶åˆ°  `Frontend/src/utils` ä¸­ã€‚

**å†è¯´ä¸€éâ€”â€”æ¯æ¬¡æ›´æ”¹åˆçº¦ä»£ç æ—¶éƒ½éœ€è¦è¿™æ ·åšã€‚**

```jsx
Deploying contracts with account:  0x65d5b68A7878A987e7A19826A7f9Aa6F5F92e10F
Account balance:  97891951082571324
WavePortal address:  0x605076bC8f2aA5562C021f267f03Af1eFFAEc7C5  (æ–°çš„åˆçº¦åœ°å€)
```

### **Hooking it all up to Frontend**

æ²¡è·‘é€š

`App.js` æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼š



update render éƒ¨åˆ†ï¼š

```jsx
return (
    <div className="mainContainer">
      <div className="dataContainer">
        <div className="header">
          ğŸ‘‹ Hey there!
        </div>

        <div className="bio">
          I am farza and I worked on self-driving cars so that's pretty cool right? Connect your Ethereum wallet and wave at me!
        </div>

        <button className="waveButton" onClick={wave}>
          Wave at Me
        </button>

        {!currentAccount && (
          <button className="waveButton" onClick={connectWallet}>
            Connect Wallet
          </button>
        )}

        {allWaves.map((wave, index) => {
          return (
            <div key={index} style={{ backgroundColor: "OldLace", marginTop: "16px", padding: "8px" }}>
              <div>Address: {wave.address}</div>
              <div>Time: {wave.timestamp.toString()}</div>
              <div>Message: {wave.message}</div>
            </div>)
        })}
      </div>
    </div>
  );
```

### èµ„åŠ©åˆçº¦ï¼Œè®¾ç½®å¥–å“ï¼Œé€ç”¨æˆ·ä»¥å¤ªåŠ

è½»æ¾å‘ç”¨æˆ·å‘é€ ETH æ˜¯æ™ºèƒ½åˆçº¦çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å®ƒä»¬æœ€é…·çš„éƒ¨åˆ†ä¹‹ä¸€

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ç»™æ¯ä¸ªå‘æˆ‘ä»¬æŒ¥æ‰‹è‡´æ„çš„äºº 0.0001 ETH

Update WavePortal.sol

```solidity
function wave(string memory _message) public {
    totalWaves += 1;
    console.log("%s has waved!", msg.sender);

    waves.push(Wave(msg.sender, _message, block.timestamp));

    emit NewWave(msg.sender, block.timestamp, _message);

    uint256 prizeAmount = 0.0001 ether;
    // require å°±åƒä¸€ä¸ªèŠ±å“¨çš„ if, True åˆ™æ‰§è¡Œï¼Œ Fasle åˆ™é€€å‡ºåŠŸèƒ½å¹¶å–æ¶ˆäº¤æ˜“
    require(
        // address(this).balance æŒ‡åˆçº¦æœ¬èº«çš„ä½™é¢ï¼Œæ¯”è¾ƒ 2 è€…ã€‚
        prizeAmount <= address(this).balance,
        "Trying to withdraw more money than the contract has."
    );
    // æ±‡æ¬¾çš„ç¥å¥‡çº¿è·¯
    (bool success, ) = (msg.sender).call{value: prizeAmount}("");
    require(success, "Failed to withdraw money from contract.");
}
```

### ä¸ºåˆçº¦æ³¨å…¥èµ„é‡‘(Fund the contract)

æˆ‘ä»¬å°†é¦–å…ˆåœ¨ run.js æµ‹è¯•ã€‚è¯·è®°ä½ï¼Œrun.js å°±åƒæˆ‘ä»¬çš„æµ‹è¯•åœºï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨éƒ¨ç½²ä¹‹å‰ç¡®ä¿æˆ‘ä»¬çš„åˆçº¦æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚åŒæ—¶è°ƒè¯•åˆçº¦ä»£ç å’Œå‰ç«¯ä»£ç çœŸçš„å¾ˆå›°éš¾ï¼Œæ‰€ä»¥ï¼Œéœ€è¦æŠŠå®ƒä¾æ¬¡ Debug ï¼

```jsx
const main = async () => {
  const waveContractFactory = await hre.ethers.getContractFactory("WavePortal");
  const waveContract = await waveContractFactory.deploy({
    // ä»é’±åŒ…ä¸­æå– ETHï¼Œæ¥ä¸ºåˆçº¦æä¾› 0.1 ETH èµ„é‡‘
    value: hre.ethers.utils.parseEther("0.1"),
  });
  await waveContract.deployed();
  console.log("Contract addy:", waveContract.address);

  /*
   * Get Contract balance
   */
  let contractBalance = await hre.ethers.provider.getBalance(
    waveContract.address
  );
  console.log(
    "Contract balance:",
    hre.ethers.utils.formatEther(contractBalance)
  );

  /*
   * Send Wave
   */
  let waveTxn = await waveContract.wave("A message!");
  await waveTxn.wait();

  /*
   * Get Contract balance to see what happened!
   */
  contractBalance = await hre.ethers.provider.getBalance(waveContract.address);
  console.log(
    "Contract balance:",
    hre.ethers.utils.formatEther(contractBalance)
  );

  let allWaves = await waveContract.getAllWaves();
  console.log(allWaves);
};

const runMain = async () => {
  try {
    await main();
    process.exit(0);
  } catch (error) {
    console.log(error);
    process.exit(1);
  }
};

runMain();
```

è°ƒç”¨ `npx hardhat run scripts/run.js` ä¼šæŠ¥é”™ï¼Œå› ä¸ºåˆçº¦ä¸­æ²¡æœ‰æ·»åŠ  `payable` propertyï¼š

```solidity
constructor() payable {
  console.log("We have been constructed!");
}
```

then run `npx hardhat run scripts/run.js` 

```solidity
Output:
We have been constructed!
Contract addy: 0x5FbDB2315678afecb367f032d93F642f64180aa3
Contract balance: 0.1
0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 has waved!
Contract balance: 0.0999
[
  [
    '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    'A message!',
    BigNumber { value: "1651886986" },
    waver: '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
    message: 'A message!',
    timestamp: BigNumber { value: "1651886986" }
  ]
]
```

make a small update toÂ `deploy.js`

```solidity
const main = async () => {
  const waveContractFactory = await hre.ethers.getContractFactory("WavePortal");
  const waveContract = await waveContractFactory.deploy({
    // å‘é€æå°‘æ•°çš„ ETH è¿›è¡Œ Deploy ï¼Œæ¯•ç«Ÿä¸Šå»äº†å°±æ²¡äº†ï¼Œè¿™åªæ˜¯ Test Contract ...  
    value: hre.ethers.utils.parseEther("0.001"),
  });

  await waveContract.deployed();

  console.log("WavePortal address: ", waveContract.address);
};

const runMain = async () => {
  try {
    await main();
    process.exit(0);
  } catch (error) {
    console.error(error);
    process.exit(1);
  }
};

runMain();
```

then `npx hardhat run scripts/deploy.js --network rinkeby` 

```solidity
output:
WavePortal address:  0xa41D211d208d151fa8Ce49992aE778B098DAFf97
```

Now when you go toÂ [Etherscan](https://rinkeby.etherscan.io/)Â and paste in your contract address you'll see that your contract now has a value of **0.001 ETH**!

æˆªè‡³ç›®å‰çš„ä»£ç  ï¼š [https://github.com/helloitsm3/buildspace-solutions/blob/create-your-first-smart-contract/my-wave-portal/contracts/WavePortal.sol](https://github.com/helloitsm3/buildspace-solutions/blob/create-your-first-smart-contract/my-wave-portal/contracts/WavePortal.sol) 

### ****Setting gas limit****

åŸºæœ¬ä¸Š Metamask å°†å°è¯•ä¼°è®¡äº¤æ˜“å°†ä½¿ç”¨å¤šå°‘ gasã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å®ƒæ˜¯é”™è¯¯çš„ï¼

ç”±äºæˆ‘ä»¬æ¶‰åŠåˆ°ä¸€äº›éšæœºæ€§ï¼Œå› æ­¤å˜å¾—æ›´åŠ å›°éš¾ã€‚å› æ­¤ï¼Œå¦‚æœåˆçº¦å‘é€äº†å¥–å“ï¼Œé‚£ä¹ˆç”±äºæˆ‘ä»¬è¿è¡Œçš„ä»£ç æ›´å¤šï¼Œå› æ­¤æ³¢åŠ¨è€…éœ€è¦æ”¯ä»˜æ›´å¤šçš„ gasã€‚

ä¼°è®¡gasæ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œè€Œä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯è®¾ç½®ä¸€ä¸ªé™åˆ¶

On App.js, I changed the line that sends the wave to

```jsx
wavePortalContract.wave(message, { gasLimit: 300000 })
```

è¿™æ ·åšçš„ç›®çš„æ˜¯è®©ç”¨æˆ·æ”¯ä»˜ 300,000 çš„å®šé¢ gasã€‚è€Œä¸”ï¼Œå¦‚æœä»–ä»¬æ²¡æœ‰åœ¨äº¤æ˜“ä¸­ä½¿ç”¨æ‰€æœ‰è¿™äº›ï¼Œä»–ä»¬å°†è‡ªåŠ¨è·å¾—é€€æ¬¾ã€‚
å› æ­¤ï¼Œå¦‚æœä¸€ç¬”äº¤æ˜“èŠ±è´¹äº† 250,000 gasï¼Œé‚£ä¹ˆåœ¨è¯¥äº¤æ˜“å®Œæˆåï¼Œç”¨æˆ·æœªä½¿ç”¨çš„å‰©ä½™ 50,000 gas å°†è¢«é€€è¿˜:)ã€‚

### éªŒè¯äº¤æ˜“

å¦‚ä½•éªŒè¯æ™ºèƒ½åˆçº¦æ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼Ÿ

è¦è¿›è¡ŒéªŒè¯ï¼Œæ‚¨å¯ä»¥åœ¨ [Rinkeby Etherscan](https://rinkeby.etherscan.io/) ä¸Šæ‰“å¼€åˆçº¦åœ°å€å¹¶æŸ¥çœ‹å·²å‘ç”Ÿçš„äº¤æ˜“ã€‚å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å„ç§æœ‰ç”¨çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è°ƒç”¨çš„æ–¹æ³•ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º Waveã€‚

å¦‚æœå•å‡» Wave äº¤æ˜“ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°åœ¨ To å±æ€§ä¸­ï¼Œå®ƒå°†è¯†åˆ«å‡ºè°ƒç”¨äº†åˆçº¦åœ°å€ã€‚å¦‚æœç”¨æˆ·ä¸­å¥–äº†ï¼Œæ‚¨ä¼šåœ¨è¯¥å­—æ®µä¸­æ³¨æ„åˆ°ï¼Œè¯¥åˆçº¦å·²å°† 0.0001 ETH ä»åˆçº¦åœ°å€è½¬ç§»åˆ°æ‚¨çš„è´¦æˆ·åœ°å€ã€‚

è¯·æ³¨æ„ï¼Œäº¤æ˜“çš„ä»·å€¼ä»ç„¶æ˜¯ 0 ETHï¼Œå› ä¸ºç”¨æˆ·ä»æœªæ”¯ä»˜ä»»ä½•è´¹ç”¨æ¥å‘èµ· waveã€‚ä»æ™ºèƒ½åˆçº¦å†…éƒ¨è½¬ç§» ETH ç§°ä¸ºâ€œå†…éƒ¨äº¤æ˜“â€ã€‚

å®æ—¶æ›´æ–° Frontend UI :

I updatedÂ `getAllWaves`Â inÂ `App.js.`

```jsx
const getAllWaves = async () => {
  const { ethereum } = window;

  try {
    if (ethereum) {
      const provider = new ethers.providers.Web3Provider(ethereum);
      const signer = provider.getSigner();
      const wavePortalContract = new ethers.Contract(contractAddress, contractABI, signer);
      const waves = await wavePortalContract.getAllWaves();

      const wavesCleaned = waves.map(wave => {
        return {
          address: wave.waver,
          timestamp: new Date(wave.timestamp * 1000),
          message: wave.message,
        };
      });

      setAllWaves(wavesCleaned);
    } else {
      console.log("Ethereum object doesn't exist!");
    }
  } catch (error) {
    console.log(error);
  }
};

/**
 * Listen in for emitter events!
 */
useEffect(() => {
  let wavePortalContract;

  const onNewWave = (from, timestamp, message) => {
    console.log("NewWave", from, timestamp, message);
    setAllWaves(prevState => [
      ...prevState,
      {
        address: from,
        timestamp: new Date(timestamp * 1000),
        message: message,
      },
    ]);
  };

  if (window.ethereum) {
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    const signer = provider.getSigner();

    wavePortalContract = new ethers.Contract(contractAddress, contractABI, signer);
    wavePortalContract.on("NewWave", onNewWave);
  }

  return () => {
    if (wavePortalContract) {
      wavePortalContract.off("NewWave", onNewWave);
    }
  };
}, []);
```

å½“ Contract å¼•å‘ NewWave äº‹ä»¶æ—¶ï¼Œæˆ‘å®é™…ä¸Šå¯ä»¥â€œå€¾å¬â€ã€‚å°±åƒä¸€ä¸ª webhookã€‚

æˆ‘è¿˜å¯ä»¥è®¿é—®æœ‰å…³è¯¥äº‹ä»¶çš„æ•°æ®ï¼Œä¾‹å¦‚ message å’Œ From ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘åœ¨æ”¶åˆ°æ­¤ Events æ—¶æ‰§è¡Œ `setAllWaves` ï¼Œè¿™æ„å‘³ç€å½“æˆ‘ä»¬æ”¶åˆ° Events æ—¶ï¼Œç”¨æˆ·çš„ message å°†è‡ªåŠ¨é™„åŠ åˆ°æˆ‘çš„ allWaves æ•°ç»„ä¸­ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ UI å°†æ›´æ–°ï¼

è¿™æ˜¯è¶…çº§å¼ºå¤§çš„ã€‚å®ƒè®©æˆ‘ä»¬å¯ä»¥åˆ›å»ºå®æ—¶æ›´æ–°çš„ç½‘ç»œåº”ç”¨ç¨‹åº! æƒ³æƒ³å¦‚æœä½ åœ¨åŒºå—é“¾ä¸Šåˆ¶ä½œ Uber æˆ– Twitter ä¹‹ç±»çš„ä¸œè¥¿ï¼Œå®æ—¶æ›´æ–°çš„ç½‘ç»œåº”ç”¨ç¨‹åºå˜å¾—éå¸¸é‡è¦ã€‚